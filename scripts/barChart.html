<!DOCTYPE html>
<html>
<meta charset="utf-8">
<style> /* set the CSS */
body { font: 12px Arial;}
path { 
    stroke: steelblue;
    stroke-width: 2;
    fill: none;
}
.axis path,
.axis line {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    shape-rendering: crispEdges;
}
.legend {
    font-size: 16px;
    font-weight: bold;
    text-anchor: middle;
}
</style>
<body>
<div id="d3id" ></div>
<!-- load the d3.js library -->    
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>
  
  var models = [
  {
    "Borough": "Bronx",
    "DiversionRate": 128.5651,
    "Bins": 108
  },
  {
    "Borough": "Brooklyn",
    "DiversionRate": 215.6459,
    "Bins": 94
  },
  {
    "Borough": "Manhattan",
    "DiversionRate": 154.3141,
    "Bins": 184
  },
  {
    "Borough": "Queens",
    "DiversionRate": 177.6617,
    "Bins": 117
  },
  {
    "Borough": "Staten Island",
    "DiversionRate": 39.5364,
    "Bins": 42
  }
];

models = models.map(i => {
  i.Borough = i.Borough;
  return i;
});

var container = d3.select('#d3id'),
    width = 800,
    height = 500,
    margin = {top: 30, right: 20, bottom: 30, left: 50},
    barPadding = .4,
    axisTicks = {qty: 5, outerSize: 0, dateFormat: '%m-%d'};

var svg = container
   .append("svg")
   .attr("width", width)
   .attr("height", height)
   .append("g")
   .attr("transform", `translate(${margin.left},${margin.top})`);

var xScale0 = d3.scaleBand().range([0, width - margin.left - margin.right]).padding(barPadding);
var xScale1 = d3.scaleBand();
var yScale = d3.scaleLinear().range([height - margin.top - margin.bottom, 0]);

var xAxis = d3.axisBottom(xScale0).tickSizeOuter(axisTicks.outerSize);
var yAxis = d3.axisLeft(yScale).ticks(axisTicks.qty).tickSizeOuter(axisTicks.outerSize);

xScale0.domain(models.map(d => d.Borough));
xScale1.domain(['DiversionRate', 'Bins']).range([0, xScale0.bandwidth()]);
yScale.domain([0, d3.max(models, d => d.DiversionRate > d.Bins ? d.DiversionRate : d.Bins)]);

var Borough = svg.selectAll(".Borough")
  .data(models)
  .enter().append("g")
  .attr("class", "Borough")
  .attr("transform", d => `translate(${xScale0(d.Borough)},0)`);

/* Add DiversionRate bars */
Borough.selectAll(".bar.DiversionRate")
  .data(d => [d])
  .enter()
  .append("rect")
  .attr("class", "bar DiversionRate")
.style("fill","#73c473")
  .attr("x", d => xScale1('DiversionRate'))
  .attr("y", d => yScale(d.DiversionRate))
  .attr("width", xScale1.bandwidth())
  .attr("height", d => {
    return height - margin.top - margin.bottom - yScale(d.DiversionRate)
  });
  
/* Add Bins bars */
Borough.selectAll(".bar.Bins")
  .data(d => [d])
  .enter()
  .append("rect")
  .attr("class", "bar Bins")
.style("fill","#4286f4")
  .attr("x", d => xScale1('Bins'))
  .attr("y", d => yScale(d.Bins))
  .attr("width", xScale1.bandwidth())
  .attr("height", d => {
    return height - margin.top - margin.bottom - yScale(d.Bins)
  });
 
// Add the X Axis
svg.append("g")
   .attr("class", "x axis")
   .attr("transform", `translate(0,${height - margin.top - margin.bottom})`)
   .style("font-size","20px")
   .call(xAxis);

// Add the Y Axis
svg.append("g")
   .attr("class", "y axis")
   .style("font-size","20px")
   .call(yAxis);

</script>
</body>
</html>
